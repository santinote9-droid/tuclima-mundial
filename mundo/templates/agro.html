<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agro Intelligence | TuClima Pro</title>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/dark-unica.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>


    <style>
        /* ================================================= */
        /* 1. CORE STYLES (MODO ENERGY / DARK OPS)           */
        /* ================================================= */
        :root {
            --bg-dark: #0f172a;       /* Slate 900 */
            --card-bg: #1e293b;       /* Slate 800 */
            --border: #334155;        /* Slate 700 */
            --accent: #4ade80;        /* Verde Agro (Green 400) */
            --text-main: #e2e8f0;     /* Slate 200 */
            --text-muted: #94a3b8;    /* Slate 400 */
            --danger: #ef4444;
            --warning: #facc15;
            --info: #3b82f6;
        }

        body { 
            background-color: var(--bg-dark); 
            color: var(--text-main); 
            font-family: 'Poppins', sans-serif; 
            margin: 0; 
            padding-bottom: 80px; /* Espacio para scroll */
        }

        /* SCROLLBAR PERSONALIZADA */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        /* HEADER T√âCNICO */
        .header-eng {
            position: sticky; top: 0; z-index: 100;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            padding: 15px 30px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }

        .brand-box { display: flex; align-items: center; gap: 12px; }
        .brand-title { 
            font-family: 'JetBrains Mono', monospace; 
            font-size: 1.5em; font-weight: 700; color: #fff; letter-spacing: -1px; 
        }
        .brand-title span { color: var(--accent); }
        .badge-pro { 
            background: rgba(250, 204, 21, 0.15); color: var(--warning); border: 1px solid rgba(250, 204, 21, 0.3);
            padding: 4px 8px; border-radius: 4px; font-size: 0.7em; font-weight: bold; letter-spacing: 1px;
        }

        .user-panel { font-family: 'JetBrains Mono', monospace; font-size: 0.85em; text-align: right; color: var(--text-muted); }
        .user-panel b { color: #fff; }

        /* CONTENEDOR PRINCIPAL */
        .dashboard-container {
            max-width: 1600px; margin: 0 auto; padding: 30px;
        }

        /* ================================================= */
        /* 2. GRID SYSTEM & CARDS (TARJETAS)                 */
        /* ================================================= */
        .agro-grid {
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); 
            gap: 25px; 
            margin-bottom: 40px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            display: flex; flex-direction: column; justify-content: space-between;
            min-height: 220px;
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            background: linear-gradient(145deg, #1e293b, #24344d);
        }

        /* Header de Tarjeta */
        .c-head {
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            padding-bottom: 12px;
        }
        .c-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85em; font-weight: 700; color: var(--text-muted);
            text-transform: uppercase; letter-spacing: 1px;
        }
        .c-icon { color: var(--accent); opacity: 0.9; }

        /* Cuerpo de Tarjeta */
        .c-main { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; margin-bottom: 15px; }
        
        .val-big {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2.8em; font-weight: 700; color: #fff;
            line-height: 1; margin-bottom: 5px;
            text-shadow: 0 0 20px rgba(0,0,0,0.2);
        }
        .val-sub { font-size: 0.9em; color: var(--text-muted); font-weight: 500; }

        .status-pill {
            display: inline-block; padding: 5px 12px; border-radius: 20px;
            font-size: 0.75em; font-weight: bold; text-transform: uppercase;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            margin-top: 10px; align-self: flex-start;
        }

        /* Tabla Mini (Data Rows) */
        .data-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 0; border-top: 1px solid rgba(255,255,255,0.05);
            font-size: 0.9em;
        }
        .dr-lbl { color: var(--text-muted); font-size: 0.9em; }
        .dr-val { color: #fff; font-family: 'JetBrains Mono', monospace; font-weight: 600; }

        /* ================================================= */
        /* 3. FORECAST & ANALYSIS BARS                       */
        /* ================================================= */
        .analysis-btn {
            width: 100%; padding: 20px; margin: 40px 0;
            background: linear-gradient(90deg, rgba(74, 222, 128, 0.1) 0%, rgba(74, 222, 128, 0.05) 100%);
            border: 1px solid var(--accent); border-radius: 12px;
            color: var(--accent); font-family: 'JetBrains Mono'; font-weight: bold; letter-spacing: 1px;
            cursor: pointer; text-align: center; transition: 0.3s;
            display: flex; justify-content: center; align-items: center; gap: 15px;
        }
        .analysis-btn:hover { background: var(--accent); color: #000; box-shadow: 0 0 20px rgba(74, 222, 128, 0.4); }

        .forecast-section {
            background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 30px;
        }
        .fs-title {
            color: #fff; font-family: 'JetBrains Mono'; font-size: 1.2em; border-left: 4px solid var(--accent); padding-left: 15px; margin-bottom: 25px;
        }
        .forecast-scroll {
            display: flex; gap: 20px; overflow-x: auto; padding-bottom: 15px;
        }
        .day-card {
            min-width: 140px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 10px; padding: 15px; text-align: center;
            transition: 0.2s;
        }
        .day-card:hover { border-color: var(--info); transform: translateY(-3px); }
        .dc-date { color: var(--accent); font-weight: bold; font-size: 0.9em; margin-bottom: 10px; text-transform: uppercase; }
        .dc-icon { width: 40px; height: 40px; margin: 10px auto; display: block; }
        .dc-temp { font-family: 'JetBrains Mono'; font-weight: bold; font-size: 1.2em; color: #fff; }
        .dc-rain { color: var(--info); font-size: 0.85em; margin-top: 8px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 5px; }

        /* ================================================= */
        /* 4. VENTANAS MODALES (DID√ÅCTICAS Y T√âCNICAS)       */
        /* ================================================= */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            z-index: 2000; display: none; justify-content: center; align-items: center;
        }
        .modal-content {
            background: #1e293b; border: 1px solid var(--border); width: 90%; max-width: 900px; max-height: 90vh;
            border-radius: 16px; padding: 40px; overflow-y: auto; position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .btn-close {
            position: absolute; top: 25px; right: 25px; background: none; border: none; 
            color: var(--text-muted); font-size: 2em; cursor: pointer; transition: 0.2s; line-height: 0.5;
        }
        .btn-close:hover { color: #fff; transform: rotate(90deg); }

        .pop-title {
            font-family: 'JetBrains Mono'; color: var(--accent); font-size: 1.6em; margin-bottom: 10px;
            display: flex; align-items: center; gap: 15px;
        }
        .pop-subtitle { color: var(--text-muted); font-size: 0.95em; margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        
        .pop-text { line-height: 1.8; color: #cbd5e1; margin-bottom: 25px; font-size: 1em; }
        .pop-text strong { color: #fff; }

        /* TABLAS T√âCNICAS DENTRO DE MODALES */
        .tech-table {
            width: 100%; border-collapse: separate; border-spacing: 0; margin: 20px 0;
            background: #0f172a; border-radius: 8px; overflow: hidden; border: 1px solid var(--border);
        }
        .tech-table th {
            background: #334155; color: #fff; font-family: 'JetBrains Mono'; font-weight: bold;
            text-transform: uppercase; font-size: 0.8em; padding: 15px; text-align: left; letter-spacing: 0.5px;
        }
        .tech-table td {
            padding: 15px; border-bottom: 1px solid var(--border); color: #cbd5e1; font-size: 0.95em;
        }
        .tech-table tr:last-child td { border-bottom: none; }
        .tech-table tr:hover td { background: rgba(255,255,255,0.02); }

        .highlight-box {
            background: rgba(59, 130, 246, 0.1); border-left: 4px solid var(--info);
            padding: 20px; border-radius: 0 8px 8px 0; color: #fff; font-weight: 500;
            display: flex; align-items: center; gap: 15px; margin-top: 20px;
        }

        /* Colores de Riesgo para Tablas */
        .risk-ok { color: var(--accent); font-weight: bold; }
        .risk-warn { color: var(--warning); font-weight: bold; }
        .risk-crit { color: var(--danger); font-weight: bold; }

    </style>

<script type="text/javascript" src="https://cdn.weglot.com/weglot.min.js"></script>
    <script>
        Weglot.initialize({
            api_key: 'wg_169c193b22e7a117be85a2f56113ab415', // <--- TU LLAVE REAL
            hide_switcher: true,         // Oculta el bot√≥n est√°ndar (usaremos el nuestro)
            auto_switch: true            // Detecta idioma autom√°tico
        });
    </script>
</head>
<body>

    <div id="google_translate_element" style="display:none;"></div>
    <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <header class="header-eng">
        <div class="brand-box">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#4ade80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"/><path d="M8.5 8.5a4 4 0 0 1 5.66 0"/><path d="M10 10a2 2 0 0 1 2.83 0"/></svg>
            <div class="brand-title">AGRO <span>INTELLIGENCE</span></div>
            <span class="badge-pro">PRO</span>
        </div>
        
        <div style="display: flex; align-items: center; gap: 20px;">
            
            <div style="text-align: right; font-family: 'JetBrains Mono'; font-size: 0.8em; color: #64748b; line-height: 1.2;">
                <div style="display:flex; align-items:center; gap:5px; justify-content: flex-end;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                    LAT: {{ lat|floatformat:4 }}
                </div>
                <div>LON: {{ lon|floatformat:4 }}</div>
            </div>

            <div style="display: flex; gap: 10px;">
                <button onclick="copiarReporte()" title="Copiar Resumen al Portapapeles" style="background: #1e293b; border: 1px solid #334155; color: #94a3b8; padding: 8px 12px; border-radius: 6px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 6px;" onmouseover="this.style.borderColor='#3b82f6'; this.style.color='#fff'" onmouseout="this.style.borderColor='#334155'; this.style.color='#94a3b8'">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>
                    <span style="font-family:'JetBrains Mono'; font-size:0.8em;">COPIAR</span>
                </button>

                <button onclick="window.print()" title="Imprimir / Guardar PDF" style="background: #1e293b; border: 1px solid #334155; color: #94a3b8; padding: 8px 12px; border-radius: 6px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 6px;" onmouseover="this.style.borderColor='#4ade80'; this.style.color='#fff'" onmouseout="this.style.borderColor='#334155'; this.style.color='#94a3b8'">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                    <span style="font-family:'JetBrains Mono'; font-size:0.8em;">PDF</span>
                </button>
                
                <a href="/" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #ef4444; padding: 8px; border-radius: 6px; display: flex; align-items: center;" title="Salir">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                </a>
            </div>
        </div>
    </header>

    <div class="dashboard-container">

        <div class="agro-grid">

            <div class="card" onclick="openModal('modGDD')">
                <div class="c-head">
                    <span class="c-title">Crecimiento (GDD)</span>
                    <svg class="c-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 22h20"/><path d="M12 22V10a5 5 0 0 1 5-5"/><path d="M12 12a5 5 0 0 0-5-5"/></svg>
                </div>
                <div class="c-main">
                    <div class="val-big" style="color: var(--warning);">{{ gdd.valor }}</div>
                    <div class="val-sub">Grados D√≠a Acumulados (7d)</div>
                    <span class="status-pill" style="color: var(--warning);">{{ gdd.estado }}</span>
                </div>
            </div>

            <div class="card" onclick="openModal('modAgua')">
                <div class="c-head">
                    <span class="c-title">Perfil de Suelo</span>
                    <svg class="c-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/><path d="M12 22v-6"/></svg>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <div style="font-size:0.75em; color:#94a3b8; font-weight:bold; margin-bottom:5px;">HUMEDAD (VOLUM√âTRICA)</div>
                    <div class="data-row">
                        <span class="dr-lbl">Sup. (0-1cm)</span>
                        <span class="dr-val" style="color: #60a5fa;">{{ suelo.sup_hum }}%</span>
                    </div>
                    <div class="data-row">
                        <span class="dr-lbl">Prof. (3-9cm)</span>
                        <span class="dr-val" style="color: #3b82f6;">{{ suelo.prof_hum }}%</span>
                    </div>
                </div>

                <div>
                    <div style="font-size:0.75em; color:#94a3b8; font-weight:bold; margin-bottom:5px; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px;">TERMOMETR√çA POR CAPAS</div>
                    <div style="display:flex; justify-content: space-between; text-align: center; margin-top:5px;">
                        <div>
                            <div style="font-size:0.7em; color:#94a3b8;">0cm</div>
                            <div style="font-family:'JetBrains Mono'; color:#fbbf24; font-weight:bold;">{{ suelo.temp_0 }}¬∞</div>
                        </div>
                        <div>
                            <div style="font-size:0.7em; color:#94a3b8;">6cm (Siembra)</div>
                            <div style="font-family:'JetBrains Mono'; color:#4ade80; font-weight:bold;">{{ suelo.temp_6 }}¬∞</div>
                        </div>
                        <div>
                            <div style="font-size:0.7em; color:#94a3b8;">18cm</div>
                            <div style="font-family:'JetBrains Mono'; color:#fff; font-weight:bold;">{{ suelo.temp_18 }}¬∞</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" onclick="openModal('modPulv')">
                <div class="c-head">
                    <span class="c-title">Pulverizaci√≥n</span>
                    <svg class="c-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"/></svg>
                </div>
                <div class="c-main">
                    <div class="val-big" style="color: {{ pulverizacion.color }};">{{ pulverizacion.delta_t }}</div>
                    <div class="val-sub">Delta T (Calidad)</div>
                    <span class="status-pill" style="color: {{ pulverizacion.color }}; border-color: {{ pulverizacion.color }};">{{ pulverizacion.estado }}</span>
                </div>
                <div class="data-row">
                    <span class="dr-lbl">Viento Sup.</span>
                    <span class="dr-val">{{ pulverizacion.viento }} km/h</span>
                </div>
            </div>

            <div class="card" onclick="openModal('modAtm')">
                <div class="c-head">
                    <span class="c-title">Atm√≥sfera</span>
                    <svg class="c-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z"/></svg>
                </div>
                <div class="data-row">
                    <span class="dr-lbl">Pto. Roc√≠o</span>
                    <span class="dr-val">{{ atmosfera.rocio }}¬∞C</span>
                </div>
                <div class="data-row">
                    <span class="dr-lbl">Presi√≥n (QNH)</span>
                    <span class="dr-val">{{ atmosfera.presion }} hPa</span>
                </div>
                <div class="data-row">
                    <span class="dr-lbl">Nubosidad</span>
                    <span class="dr-val">{{ atmosfera.nubes }}%</span>
                </div>
                <div class="data-row">
                    <span class="dr-lbl">Humedad Amb.</span>
                    <span class="dr-val">{{ ambiente.humedad }}%</span>
                </div>
            </div>

            <div class="card" onclick="openModal('modRad')">
                <div class="c-head">
                    <span class="c-title">Radiaci√≥n Solar</span>
                    <svg class="c-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                </div>
                <div class="c-main">
                    <div class="val-big" style="color: #fbbf24;">{{ radiacion.watts }}</div>
                    <div class="val-sub">W/m¬≤ (Irradiancia)</div>
                </div>
                <div class="data-row">
                    <span class="dr-lbl">Potencial</span>
                    <span class="dr-val">{{ radiacion.estado }}</span>
                </div>
            </div>

            <div class="card" onclick="openModal('modBal')">
                <div class="c-head">
                    <span class="c-title">Balance (7 D√≠as)</span>
                    <svg class="c-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
                </div>
                <div style="display:flex; justify-content: space-around; text-align: center; margin: 10px 0;">
                    <div>
                        <div style="color: #60a5fa; font-weight: bold; font-size: 0.8em;">LLUVIA</div>
                        <div style="color: #fff; font-weight: bold; font-size: 1.4em;">{{ balance.lluvia }}</div>
                    </div>
                    <div style="border-right: 1px solid rgba(255,255,255,0.1);"></div>
                    <div>
                        <div style="color: #fbbf24; font-weight: bold; font-size: 0.8em;">EVAPO</div>
                        <div style="color: #fff; font-weight: bold; font-size: 1.4em;">{{ balance.evapo }}</div>
                    </div>
                </div>
                <div style="background: rgba(255,255,255,0.05); padding: 8px; border-radius: 6px; text-align: center; font-family: 'JetBrains Mono'; font-weight: bold; color: {{ balance.color_diff }};">
                    NETO: {{ balance.diff }} mm
                </div>
            </div>

            <div class="card" onclick="openModal('modRaiz')">
                <div class="c-head">
                    <span class="c-title">Zona Radicular (-18cm)</span>
                    <svg class="c-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14"/><path d="M19 12l-7 7-7-7"/></svg>
                </div>
                <div class="c-main">
                    <div class="val-big" style="color: var(--accent);">{{ raices.temp }}¬∞</div>
                    <div class="val-sub">Temperatura Profunda</div>
                </div>
                <div class="data-row">
                    <span class="dr-lbl">Humedad (18-27cm)</span>
                    <span class="dr-val" style="color: #3b82f6;">{{ raices.hum }}%</span>
                </div>
            </div>

            <div class="card" onclick="openModal('modVPD')">
                <div class="c-head">
                    <span class="c-title">Estr√©s (VPD)</span>
                    <svg class="c-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                </div>
                <div class="c-main">
                    <div class="val-big" style="color: {{ estres.color }};">{{ estres.vpd }}</div>
                    <div class="val-sub">kPa (D√©ficit de Vapor)</div>
                </div>
                <span class="status-pill" style="color: {{ estres.color }}; border-color: {{ estres.color }};">{{ estres.estado }}</span>
            </div>

            <div class="card" onclick="openModal('modETo')">
                <div class="c-head">
                    <span class="c-title">Evapotranspiraci√≥n</span>
                    <svg class="c-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.74 5.89c.98 1.01 1.52 2.38 1.52 3.82 0 2.96-2.26 5.6-5.78 5.6-3.51 0-7.48-2.64-7.48-5.6 0-1.44.54-2.81 1.52-3.82L12 2.69z"/></svg>
                </div>
                <div class="c-main">
                    <div class="val-big" style="color: #a78bfa;">{{ eto.hoy }}</div>
                    <div class="val-sub">mm / d√≠a (Hoy)</div>
                </div>
                <div class="data-row">
                    <span class="dr-lbl">Proyecci√≥n Sem.</span>
                    <span class="dr-val">~{{ eto.proyeccion }} mm</span>
                </div>
            </div>

        </div> <div class="analysis-btn" onclick="openModal('modGraph')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="8" y1="12" x2="16" y2="12"/><line x1="12" y1="16" x2="12" y2="8"/></svg>
            ABRIR AN√ÅLISIS DE BALANCE H√çDRICO (GR√ÅFICO)
        </div>


        <section class="forecast-section">
            <div class="fs-title">PRON√ìSTICO EXTENDIDO DE CULTIVO (14 D√çAS)</div>
            <div class="forecast-scroll">
                {% for fecha, max, min, lluvia, prob, code in dias_extendidos %}
                <div class="day-card">
                    <div class="dc-date">{{ fecha|slice:"5:" }}</div>
                    <svg class="dc-icon" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
                        {% if code < 3 %}
                            <circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2"/>
                        {% elif code < 50 %}
                            <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/>
                        {% elif code < 80 %}
                            <line x1="16" y1="13" x2="16" y2="21"/><line x1="8" y1="13" x2="8" y2="21"/><line x1="12" y1="15" x2="12" y2="23"/><path d="M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25"/>
                        {% else %}
                             <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        {% endif %}
                    </svg>
                    <div class="dc-temp">{{ max }}¬∞ <span style="font-size:0.7em; color:var(--text-muted); font-weight:normal;">{{ min }}¬∞</span></div>
                    <div class="dc-rain">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.74 5.89c.98 1.01 1.52 2.38 1.52 3.82 0 2.96-2.26 5.6-5.78 5.6-3.51 0-7.48-2.64-7.48-5.6 0-1.44.54-2.81 1.52-3.82L12 2.69z"/></svg>
                        {{ lluvia }}mm
                    </div>
                    <div style="font-size:0.75em; color:var(--text-muted); margin-top:4px;">{{ prob }}%</div>
                </div>
                {% endfor %}
            </div>
        </section>

    </div> <div id="modGraph" class="modal-overlay">
        <div class="modal-content">
            <button class="btn-close" onclick="closeModal('modGraph')">√ó</button>
            <div class="pop-title">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
                Balance H√≠drico Proyectado
            </div>
            <div class="pop-subtitle">An√°lisis de Ingresos (Lluvia) vs Egresos (ETo) para los pr√≥ximos 14 d√≠as.</div>
            
            <div id="container-agro" style="width:100%; height:400px;"></div>
            
            <div class="highlight-box">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                <div>
                    <strong>Interpretaci√≥n:</strong> Las barras azules representan el agua disponible. La l√≠nea amarilla es la demanda de la atm√≥sfera. Si la l√≠nea supera las barras consistentemente, se recomienda riego suplementario.
                </div>
            </div>
        </div>
    </div>

    <div id="modGDD" class="modal-overlay">
        <div class="modal-content">
            <button class="btn-close" onclick="closeModal('modGDD')">√ó</button>
            <div class="pop-title">Grados D√≠a de Crecimiento (GDD)</div>
            <div class="pop-text">
                Unidad biol√≥gica de tiempo. El GDD mide la acumulaci√≥n de calor √∫til para la fotos√≠ntesis, descartando temperaturas extremas que detienen el metabolismo.
                <br>F√≥rmula: <code>((Tm√°x + Tm√≠n) / 2) - Tbase</code>.
            </div>
            
            <table class="tech-table">
                <thead>
                    <tr><th>Cultivo</th><th>T. Base</th><th>T. √ìptima</th><th>Riesgo Calor</th></tr>
                </thead>
                <tbody>
                    <tr><td>Trigo / Cebada</td><td>0 - 4¬∞C</td><td>15 - 20¬∞C</td><td class="risk-crit">> 28¬∞C</td></tr>
                    <tr><td>Ma√≠z (Zea Mays)</td><td>10¬∞C</td><td>25 - 30¬∞C</td><td class="risk-crit">> 35¬∞C</td></tr>
                    <tr><td>Soja (Glycine max)</td><td>10¬∞C</td><td>22 - 28¬∞C</td><td class="risk-crit">> 38¬∞C</td></tr>
                    <tr><td>Girasol</td><td>6¬∞C</td><td>20 - 25¬∞C</td><td class="risk-crit">> 32¬∞C</td></tr>
                    <tr><td>Algod√≥n</td><td>15¬∞C</td><td>28 - 32¬∞C</td><td class="risk-crit">> 40¬∞C</td></tr>
                </tbody>
            </table>
            
            <div class="highlight-box" style="border-left-color: var(--warning);">
                <strong>ESTADO ACTUAL:</strong> {{ gdd.valor }} GDD Acumulados ({{ gdd.estado }})
            </div>
        </div>
    </div>

    <div id="modAgua" class="modal-overlay">
        <div class="modal-content">
            <button class="btn-close" onclick="closeModal('modAgua')">√ó</button>
            <div class="pop-title">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                F√≠sica de Suelos: Agua y Temperatura
            </div>
            <div class="pop-text">
                Monitorizaci√≥n estratificada del perfil del suelo. La interacci√≥n entre humedad y temperatura a distintas profundidades determina la viabilidad de la siembra y la eficiencia radicular.
            </div>

            <div style="color:#fff; font-family:'JetBrains Mono'; font-weight:bold; margin-bottom:10px; border-left:4px solid #fbbf24; padding-left:10px; margin-top:30px;">
                PERFIL T√âRMICO (G√âNESIS RADICULAR)
            </div>
            <table class="tech-table">
                <thead>
                    <tr><th>Profundidad</th><th>Valor Actual</th><th>Importancia Agron√≥mica</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td>0 cm (Superficie)</td>
                        <td style="color:#fbbf24; font-weight:bold;">{{ suelo.temp_0 }}¬∞C</td>
                        <td>Riesgo de "golpe de calor" en cuello de pl√°ntula. Volatilidad de herbicidas.</td>
                    </tr>
                    <tr>
                        <td>6 cm (Cama Siembra)</td>
                        <td style="color:#4ade80; font-weight:bold;">{{ suelo.temp_6 }}¬∞C</td>
                        <td><strong>CR√çTICO GERMINACI√ìN.</strong><br>Ma√≠z requiere >10¬∞C estables a esta prof.</td>
                    </tr>
                    <tr>
                        <td>18 cm (Ra√≠z Activa)</td>
                        <td style="color:#fff; font-weight:bold;">{{ suelo.temp_18 }}¬∞C</td>
                        <td>Absorci√≥n de nutrientes. <br>Si T < 15¬∞C, el F√≥sforo se bloquea (hojas violetas).</td>
                    </tr>
                    <tr>
                        <td>54 cm (Profundo)</td>
                        <td style="color:#94a3b8; font-weight:bold;">{{ suelo.temp_54 }}¬∞C</td>
                        <td>Inercia t√©rmica y reserva de agua.</td>
                    </tr>
                </tbody>
            </table>

            <div style="color:#fff; font-family:'JetBrains Mono'; font-weight:bold; margin-bottom:10px; border-left:4px solid #3b82f6; padding-left:10px; margin-top:30px;">
                CONSTANTES H√çDRICAS
            </div>
            <table class="tech-table">
                <thead>
                    <tr><th>Tipo de Suelo</th><th>Cap. Campo (CC)</th><th>Pto. Marchitez (PMP)</th><th>Agua √ötil (AU)</th></tr>
                </thead>
                <tbody>
                    <tr><td>Arcilloso</td><td>40 - 50%</td><td>25 - 30%</td><td class="risk-ok">Alta Retenci√≥n</td></tr>
                    <tr><td>Franco (Ideal)</td><td>25 - 35%</td><td>10 - 15%</td><td class="risk-ok">Equilibrado</td></tr>
                    <tr><td>Arenoso</td><td>10 - 15%</td><td>3 - 5%</td><td class="risk-crit">Baja (Drenaje r√°pido)</td></tr>
                </tbody>
            </table>

            <div class="highlight-box">
                <div>
                    <div><strong>Humedad Cama Siembra:</strong> {{ suelo.sup_hum }}%</div>
                    <div><strong>Temp. Cama Siembra:</strong> {{ suelo.temp_6 }}¬∞C</div>
                </div>
            </div>
        </div>
    </div>

    <div id="modPulv" class="modal-overlay">
        <div class="modal-content">
            <button class="btn-close" onclick="closeModal('modPulv')">√ó</button>
            <div class="pop-title">Calidad de Aplicaci√≥n (Delta T)</div>
            <div class="pop-text">
                El Delta T relaciona la Temperatura Seca y H√∫meda para predecir la vida √∫til de la gota pulverizada. Es el est√°ndar global para evitar derivas y evaporaci√≥n.
            </div>
            
            <table class="tech-table">
                <thead>
                    <tr><th>Valor Delta T</th><th>Condici√≥n</th><th>Consecuencia F√≠sico-Qu√≠mica</th></tr>
                </thead>
                <tbody>
                    <tr><td>0 - 2</td><td class="risk-warn">RIESGO INVERSI√ìN</td><td>La gota no desciende, queda suspendida. Deriva masiva.</td></tr>
                    <tr><td>2 - 8</td><td class="risk-ok">EXCELENTE</td><td>M√°xima absorci√≥n sist√©mica. Supervivencia ideal.</td></tr>
                    <tr><td>8 - 10</td><td class="risk-warn">MARGINAL</td><td>Usar gota gruesa o coadyuvantes antievaporantes.</td></tr>
                    <tr><td>> 10</td><td class="risk-crit">CR√çTICO</td><td>Evaporaci√≥n instant√°nea. P√©rdida econ√≥mica total.</td></tr>
                </tbody>
            </table>

            <div class="highlight-box" style="border-left-color: {{ pulverizacion.color }};">
                 <strong>CONDICI√ìN ACTUAL:</strong> Delta T {{ pulverizacion.delta_t }} ({{ pulverizacion.estado }}) | Viento: {{ pulverizacion.viento }} km/h
            </div>
        </div>
    </div>

    <div id="modAtm" class="modal-overlay">
        <div class="modal-content">
            <button class="btn-close" onclick="closeModal('modAtm')">√ó</button>
            <div class="pop-title">Din√°mica Atmosf√©rica</div>
            <div class="pop-text">
                Variables que afectan la presi√≥n de plagas y enfermedades.
            </div>
            <table class="tech-table">
                <thead>
                    <tr><th>Variable</th><th>Valor Actual</th><th>Impacto Agron√≥mico</th></tr>
                </thead>
                <tbody>
                    <tr><td>Punto de Roc√≠o</td><td>{{ atmosfera.rocio }}¬∞C</td><td>Si T¬∞ Ambiente = P. Roc√≠o => Hoja Mojada (Riesgo F√∫ngico).</td></tr>
                    <tr><td>Presi√≥n QNH</td><td>{{ atmosfera.presion }} hPa</td><td>Baja presi√≥n (<1010) favorece emergencia de insectos.</td></tr>
                    <tr><td>Nubosidad</td><td>{{ atmosfera.nubes }}%</td><td>Afecta la tasa fotosint√©tica neta.</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="modRad" class="modal-overlay">
        <div class="modal-content">
            <button class="btn-close" onclick="closeModal('modRad')">√ó</button>
            <div class="pop-title">Radiaci√≥n Solar (PAR)</div>
            <div class="pop-text">
                No toda la luz sirve. La Radiaci√≥n Fotosint√©ticamente Activa (PAR) es la fracci√≥n que la planta usa para producir biomasa.
            </div>
            <div class="highlight-box" style="background: rgba(251, 191, 36, 0.1); border-left-color: #fbbf24;">
                <strong>POTENCIA ACTUAL:</strong> {{ radiacion.watts }} W/m¬≤ <br>
                Estado: {{ radiacion.estado }}
            </div>
        </div>
    </div>

    <div id="modBal" class="modal-overlay">
        <div class="modal-content">
            <button class="btn-close" onclick="closeModal('modBal')">√ó</button>
            <div class="pop-title">Detalle de Balance H√≠drico (14 D√≠as)</div>
            <div class="pop-text">Registro contable de cada mil√≠metro de agua que entra y sale del sistema suelo-planta.</div>
            
            <table class="tech-table">
                <thead>
                    <tr><th>Fecha</th><th>Ingreso (Lluvia)</th><th>Egreso (ETo)</th><th>Saldo Diario</th></tr>
                </thead>
                <tbody>
                    {% for dia in tabla_balance %}
                    <tr>
                        <td>{{ dia.fecha }}</td>
                        <td style="color:#60a5fa;">{{ dia.lluvia }} mm</td>
                        <td style="color:#fbbf24;">{{ dia.eto }} mm</td>
                        <td style="font-weight:bold; color:{{ dia.color }};">
                            {% if dia.diff > 0 %}+{% endif %}{{ dia.diff }} mm
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div id="modRaiz" class="modal-overlay">
        <div class="modal-content">
            <button class="btn-close" onclick="closeModal('modRaiz')">√ó</button>
            <div class="pop-title">Fisiolog√≠a Radicular (-18cm)</div>
            <div class="pop-text">
                Las ra√≠ces detienen su absorci√≥n de nutrientes (especialmente F√≥sforo) con temperaturas bajas.
            </div>
            <table class="tech-table">
                <thead>
                    <tr><th>Cultivo</th><th>T. Suelo M√≠nima</th><th>Consecuencia</th></tr>
                </thead>
                <tbody>
                    <tr><td>Ma√≠z</td><td>< 12¬∞C</td><td class="risk-crit">Coloraci√≥n viol√°cea (D√©ficit F√≥sforo)</td></tr>
                    <tr><td>Soja</td><td>< 18¬∞C</td><td class="risk-warn">Menor actividad de n√≥dulos (Fijaci√≥n N)</td></tr>
                    <tr><td>Trigo</td><td>< 4¬∞C</td><td class="risk-ok">Tolerante (Crecimiento lento)</td></tr>
                </tbody>
            </table>
            <div class="highlight-box">
                TEMP SUELO ACTUAL: {{ raices.temp }}¬∞C
            </div>
        </div>
    </div>

    <div id="modVPD" class="modal-overlay">
        <div class="modal-content">
            <button class="btn-close" onclick="closeModal('modVPD')">√ó</button>
            <div class="pop-title">D√©ficit de Presi√≥n de Vapor (VPD)</div>
            <div class="pop-text">
                Mide la "sed" de la atm√≥sfera. Es mucho m√°s preciso que la humedad relativa para determinar si la planta cierra sus estomas.
            </div>
            <table class="tech-table">
                <thead>
                    <tr><th>VPD (kPa)</th><th>Estado Planta</th><th>Fisiolog√≠a</th></tr>
                </thead>
                <tbody>
                    <tr><td>< 0.4</td><td class="risk-warn">Pasiva</td><td>Transpiraci√≥n casi nula. Riesgo Moho.</td></tr>
                    <tr><td>0.4 - 1.2</td><td class="risk-ok">SALUDABLE</td><td>M√°xima apertura estom√°tica. Crecimiento.</td></tr>
                    <tr><td>1.2 - 1.6</td><td class="risk-warn">Alerta</td><td>Comienza regulaci√≥n estom√°tica.</td></tr>
                    <tr><td>> 1.6</td><td class="risk-crit">ESTR√âS</td><td>Cierre de estomas. Detenci√≥n fotos√≠ntesis.</td></tr>
                </tbody>
            </table>
             <div class="highlight-box" style="border-left-color: {{ estres.color }};">
                VALOR ACTUAL: {{ estres.vpd }} kPa ({{ estres.estado }})
            </div>
        </div>
    </div>

    <div id="modETo" class="modal-overlay">
        <div class="modal-content">
            <button class="btn-close" onclick="closeModal('modETo')">√ó</button>
            <div class="pop-title">Evapotranspiraci√≥n (Penman-Monteith)</div>
            <div class="pop-text">
                C√°lculo combinado de radiaci√≥n + temperatura + viento + humedad para determinar la demanda de agua de un cultivo de referencia (Pasto).
                <br><strong>F√≥rmula de Riego:</strong> ETo x Kc (Coeficiente cultivo).
            </div>
             <div class="highlight-box" style="background: rgba(167, 139, 250, 0.1); border-left-color: #a78bfa;">
                P√âRDIDA HOY: {{ eto.hoy }} mm <br>
                PROYECCI√ìN SEMANAL: {{ eto.proyeccion }} mm
            </div>
        </div>
    </div>

<div id="traducciones-grafico" style="display: none;">
    <span id="txt-lluvia">Lluvia (Ingreso)</span>
    <span id="txt-eto">Evapotranspiraci√≥n (Demanda)</span>
    <span id="txt-mm">Mil√≠metros (mm)</span>
</div>

<script>
    let chartAgro; // Variable global para el gr√°fico

    // ------------------------------------------
    // 1. FUNCI√ìN PARA ABRIR MODAL (Recuperada y Blindada)
    // ------------------------------------------
    function openModal(id) { 
        const modal = document.getElementById(id);
        if(modal) {
            modal.style.display = 'flex';
            // TRUCO CLAVE: Si el gr√°fico ya existe, obligarlo a ajustarse al tama√±o del modal
            if (chartAgro) {
                setTimeout(() => { chartAgro.reflow(); }, 10);
            }
        } else {
            console.error("No encuentro el modal con ID:", id);
        }
    }

    function closeModal(id) { 
        const modal = document.getElementById(id);
        if(modal) modal.style.display = 'none'; 
    }

    // Cerrar al hacer clic afuera
    window.onclick = function(event) {
        if (event.target.classList.contains('modal-overlay')) {
            event.target.style.display = "none";
        }
    }

    // ------------------------------------------
    // 2. DIBUJAR GR√ÅFICO (Con protecci√≥n anti-errores)
    // ------------------------------------------
    function renderChart() {
        // Datos b√°sicos (protegidos)
        const labels = {{ grafico_agro.fechas|safe }};
        const dataLluvia = {{ grafico_agro.lluvia|safe }};
        const dataEto = {{ grafico_agro.eto|safe }};

        // Intentar leer traducciones (si fallan, usa espa√±ol por defecto)
        let txtLluvia = "Lluvia (Ingreso)";
        let txtEto = "Evapotranspiraci√≥n (Demanda)";
        let txtAxis = "Mil√≠metros (mm)";

        try {
            if(document.getElementById('txt-lluvia')) txtLluvia = document.getElementById('txt-lluvia').innerText;
            if(document.getElementById('txt-eto')) txtEto = document.getElementById('txt-eto').innerText;
            if(document.getElementById('txt-mm')) txtAxis = document.getElementById('txt-mm').innerText;
        } catch (e) { console.log("Usando textos por defecto"); }

        // Configuraci√≥n Highcharts
        chartAgro = Highcharts.chart('container-agro', {
            chart: { 
                type: 'column', 
                backgroundColor: 'transparent', 
                style: { fontFamily: 'Poppins' } 
            },
            exporting: {
                enabled: true,
                filename: 'TuClima_Balance_Hidrico',
                buttons: { contextButton: { theme: { fill: '#1e293b' } } },
                chartOptions: { chart: { backgroundColor: '#1e293b' } }
            },
            title: { text: '' },
            xAxis: { 
                categories: labels, 
                lineColor: '#334155', 
                labels: { style: { color: '#94a3b8', fontFamily:'JetBrains Mono' } } 
            },
            yAxis: { 
                title: { text: txtAxis, style: { color: '#94a3b8' } }, 
                gridLineColor: '#334155',
                labels: { style: { color: '#e2e8f0' } }
            },
            legend: { itemStyle: { color: '#e2e8f0' } },
            tooltip: { shared: true, backgroundColor: '#1e293b', style: { color: '#fff' }, borderColor: '#4ade80' },
            series: [{
                name: txtLluvia,
                data: dataLluvia,
                color: '#3b82f6',
                borderRadius: 4,
                borderWidth: 0
            }, {
                name: txtEto,
                type: 'spline',
                data: dataEto,
                color: '#facc15',
                lineWidth: 3,
                marker: { fillColor: '#1e293b', lineWidth: 2, lineColor: '#facc15' }
            }],
            credits: { enabled: false }
        });
    }

    // ------------------------------------------
    // 3. INICIAR TODO
    // ------------------------------------------
    document.addEventListener("DOMContentLoaded", function() {
        renderChart(); // Dibujar al cargar

        // Sincronizar con Weglot (si existe)
        if (typeof Weglot !== 'undefined') {
            Weglot.on('initialized', renderChart);
            Weglot.on('languageChanged', renderChart);
        }
    });

    // ------------------------------------------
    // 4. GENERADOR DE REPORTE (COPIAR)
    // ------------------------------------------
    function copiarReporte() {
        const reporte = `
üì° AGRO INTELLIGENCE - REPORTE T√âCNICO INTEGRAL
===============================================
üìç Ubicaci√≥n: {{ lat|floatformat:4 }}, {{ lon|floatformat:4 }}
üìÖ Fecha: ${new Date().toLocaleString()}
üë§ Operador: {{ user.username|upper }}

üå§Ô∏è ATM√ìSFERA Y AMBIENTE
-----------------------
‚Ä¢ Humedad Ambiente: {{ ambiente.humedad }}%
‚Ä¢ Presi√≥n (QNH): {{ atmosfera.presion }} hPa
‚Ä¢ Punto de Roc√≠o: {{ atmosfera.rocio }}¬∞C
‚Ä¢ Nubosidad: {{ atmosfera.nubes }}%
‚Ä¢ Radiaci√≥n: {{ radiacion.watts }} W/m¬≤ ({{ radiacion.estado }})

üöú INDICES AGRON√ìMICOS
----------------------
‚Ä¢ Crecimiento (GDD): {{ gdd.valor }} ({{ gdd.estado }})
‚Ä¢ Estr√©s (VPD): {{ estres.vpd }} kPa ({{ estres.estado }})
‚Ä¢ Evapotranspiraci√≥n (ETo): {{ eto.hoy }} mm/d√≠a
‚Ä¢ ETo Proyectada (7d): ~{{ eto.proyeccion }} mm

üí® CONDICIONES DE PULVERIZACI√ìN
-------------------------------
‚Ä¢ Delta T: {{ pulverizacion.delta_t }}
‚Ä¢ Estado: {{ pulverizacion.estado }}
‚Ä¢ Viento: {{ pulverizacion.viento }} km/h

üå± F√çSICA DE SUELOS (Perfil Completo)
-------------------------------------
[Humedad Volum√©trica]
‚Ä¢ Superficial (0-1cm): {{ suelo.sup_hum }}%
‚Ä¢ Profunda (3-9cm): {{ suelo.prof_hum }}%
‚Ä¢ Radicular (9-27cm): {{ raices.hum }}%

[Termometr√≠a por Capas]
‚Ä¢ 0 cm (Sup): {{ suelo.temp_0 }}¬∞C
‚Ä¢ 6 cm (Cama Siembra): {{ suelo.temp_6 }}¬∞C
‚Ä¢ 18 cm (Ra√≠z Activa): {{ suelo.temp_18 }}¬∞C
‚Ä¢ 54 cm (Reserva): {{ suelo.temp_54 }}¬∞C

‚öñÔ∏è BALANCE H√çDRICO (7 D√≠as)
---------------------------
‚Ä¢ Ingresos (Lluvia): {{ balance.lluvia }} mm
‚Ä¢ Egresos (Evapo): {{ balance.evapo }} mm
‚Ä¢ SALDO NETO: {{ balance.diff }} mm

üóìÔ∏è PRON√ìSTICO EXTENDIDO (Pr√≥ximos 5 d√≠as)
-----------------------------------------
{% for fecha, max, min, lluvia, prob, code in dias_extendidos|slice:":5" %}
‚Ä¢ {{ fecha|slice:"5:" }}: M√°x {{ max }}¬∞ / M√≠n {{ min }}¬∞ | üíß {{ lluvia }}mm ({{ prob }}%) {% endfor %}

-----------------------------------------------
Generado por TuClima Pro - www.tuclima.com
        `;

        navigator.clipboard.writeText(reporte).then(() => {
            alert("‚úÖ ¬°Reporte Completo Copiado!");
        }).catch(err => {
            console.error('Error al copiar:', err);
            alert("‚ùå Error de permisos.");
        });
    }
</script>


</body>
</html>