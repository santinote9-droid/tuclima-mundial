<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sala de Guerra | Comparador de Modelos</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body {
            background-color: #0f172a;
            color: #e2e8f0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 40px;
        }
        .card {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid #334155;
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        /* GRID DE BOTONES */
        .selector-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        .btn-var {
            background: #1e293b;
            border: 1px solid #334155;
            color: #94a3b8;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px;
            font-weight: 600; font-size: 0.9em;
        }
        .btn-var:hover { background: #334155; color: #fff; transform: translateY(-2px); }
        .btn-var.active {
            background: rgba(56, 189, 248, 0.1);
            border-color: #38bdf8;
            color: #38bdf8;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.1);
        }

        /* ANIMACIONES */
        @keyframes pulse-slow { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-3px); } 100% { transform: translateY(0px); } }
        @keyframes rain-drop { 0% { transform: translateY(0); opacity:0; } 50% { opacity:1; } 100% { transform: translateY(5px); opacity:0; } }

        .anim-pulse { animation: pulse-slow 2s infinite; }
        .anim-spin { animation: spin 4s linear infinite; }
        .anim-float { animation: float 3s ease-in-out infinite; }
        .anim-rain { animation: rain-drop 1.5s infinite; }
    </style>

<script type="text/javascript" src="https://cdn.weglot.com/weglot.min.js"></script>
    <script>
        Weglot.initialize({
            api_key: 'wg_169c193b22e7a117be85a2f56113ab415', // <--- TU LLAVE REAL
            hide_switcher: true,         // Oculta el bot√≥n est√°ndar (usaremos el nuestro)
            auto_switch: true            // Detecta idioma autom√°tico
        });
    </script>

</head>
<body>

    <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px;">
        <div>
            <h5 style="color: #64748b; margin: 0; text-transform: uppercase; letter-spacing: 2px;">War Room Anal√≠tica</h5>
            <h1 style="margin: 0; font-size: 2.5em; display: flex; align-items: center; gap: 15px;">
                <svg class="anim-pulse" style="width:40px; height:40px; color: #38bdf8;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                Comparador de Modelos
            </h1>
            <p style="color: #94a3b8; margin-top: 5px;">An√°lisis de divergencia para: <strong style="color:white">{{ ciudad }}</strong></p>
        </div>

        <div style="text-align: right;">
            <div style="font-size: 0.8em; color: #94a3b8;">√çndice de Consenso</div>
            <div style="font-size: 3em; font-weight: 800; color: {{ color_confianza }}; text-shadow: 0 0 20px {{ color_confianza }}40;">
                {{ confianza }}%
            </div>
            <div style="color: {{ color_confianza }}; font-weight: bold; border: 1px solid {{ color_confianza }}; padding: 2px 10px; border-radius: 10px; display: inline-block; font-size: 0.7em;">
                CONFIANZA {{ estado_confianza }}
            </div>
        </div>
    </div>

    <div class="selector-grid">
        <button class="btn-var active" onclick="updateChart('temp', this)">
            <svg class="anim-pulse" style="width:24px;height:24px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/><path d="M12 14v.01"/></svg>
            Temperatura
        </button>
        
        <button class="btn-var" onclick="updateChart('hum', this)">
            <svg class="anim-float" style="width:24px;height:24px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
            Humedad Rel.
        </button>

        <button class="btn-var" onclick="updateChart('pres', this)">
            <svg class="anim-pulse" style="width:24px;height:24px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
            Presi√≥n (hPa)
        </button>

        <button class="btn-var" onclick="updateChart('wind', this)">
            <svg class="anim-spin" style="width:24px;height:24px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"/></svg>
            Viento
        </button>

        <button class="btn-var" onclick="updateChart('rain', this)">
            <svg class="anim-rain" style="width:24px;height:24px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 16.2A4.5 4.5 0 0 0 3.2 14.2"/><path d="M8 19l-2 3"/><path d="M14 19l-2 3"/><path d="M20 19l-2 3"/></svg>
            Lluvia
        </button>
        
        <button class="btn-var" onclick="updateChart('cloud', this)">
            <svg class="anim-float" style="width:24px;height:24px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.5 19c0-1.7-1.3-3-3-3h-11a4 4 0 0 1-3.8-5.1 4 4 0 0 1 3.5-3.8c.4 0 .8.1 1.2.2A5.5 5.5 0 0 1 14 5c2.6 0 4.8 1.9 5.3 4.4 2.1.4 3.7 2.3 3.7 4.6 0 2.8-2.2 5-5 5z"/></svg>
            Nubosidad
        </button>
    </div>

    <div class="card">
        <canvas id="warChart" style="max-height: 450px; width: 100%;"></canvas>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 30px;">
        <div style="background: rgba(99, 102, 241, 0.1); border-left: 4px solid #6366f1; padding: 15px; border-radius: 8px;">
            <h3 style="color: #6366f1; margin: 0; display: flex; align-items: center; gap: 8px;">üá´üá∑ MeteoFrance</h3>
            <p style="font-size: 0.8em; color: #cbd5e1; margin-top: 5px;">Modelo Franc√©s (ARPEGE). Alta precisi√≥n europea y global.</p>
        </div>
        <div style="background: rgba(46, 213, 115, 0.1); border-left: 4px solid #2ed573; padding: 15px; border-radius: 8px;">
            <h3 style="color: #2ed573; margin: 0; display: flex; align-items: center; gap: 8px;">üá∫üá∏ NOAA GFS</h3>
            <p style="font-size: 0.8em; color: #cbd5e1; margin-top: 5px;">Modelo Americano. Est√°ndar mundial.</p>
        </div>
        <div style="background: rgba(255, 165, 2, 0.1); border-left: 4px solid #ffa502; padding: 15px; border-radius: 8px;">
            <h3 style="color: #ffa502; margin: 0; display: flex; align-items: center; gap: 8px;">üá©üá™ DWD ICON</h3>
            <p style="font-size: 0.8em; color: #cbd5e1; margin-top: 5px;">Modelo Alem√°n. Alta resoluci√≥n local.</p>
        </div>
    </div>

    <div style="text-align: center; margin-top: 30px;">
        <a href="/?lat={{lat}}&lon={{lon}}" style="text-decoration: none; color: #94a3b8; border: 1px solid #334155; padding: 10px 25px; border-radius: 30px; font-size: 0.9em; transition:0.3s;">
            ‚Üê Retornar al Mando
        </a>
    </div>

    <script>
        // DATOS DESDE PYTHON
        const labels = {{ labels|safe }};
        const dataSets = {
            'temp': {
                eu: {{ t_eu|safe }}, gfs: {{ t_gfs|safe }}, icon: {{ t_icon|safe }},
                unit: 'Temperatura (¬∞C)', color: 'rgba(99, 102, 241, 0.2)'
            },
            'hum': {
                eu: {{ h_eu|safe }}, gfs: {{ h_gfs|safe }}, icon: {{ h_icon|safe }},
                unit: 'Humedad Relativa (%)', color: 'rgba(6, 182, 212, 0.2)'
            },
            'pres': {
                eu: {{ pr_eu|safe }}, gfs: {{ pr_gfs|safe }}, icon: {{ pr_icon|safe }},
                unit: 'Presi√≥n (hPa)', color: 'rgba(168, 85, 247, 0.2)'
            },
            'wind': {
                eu: {{ w_eu|safe }}, gfs: {{ w_gfs|safe }}, icon: {{ w_icon|safe }},
                unit: 'Viento (km/h)', color: 'rgba(56, 189, 248, 0.2)'
            },
            'rain': {
                eu: {{ p_eu|safe }}, gfs: {{ p_gfs|safe }}, icon: {{ p_icon|safe }},
                unit: 'Lluvia (mm)', color: 'rgba(46, 213, 115, 0.2)'
            },
            'cloud': {
                eu: {{ c_eu|safe }}, gfs: {{ c_gfs|safe }}, icon: {{ c_icon|safe }},
                unit: 'Cobertura Nubosa (%)', color: 'rgba(148, 163, 184, 0.2)'
            }
        };

        const ctx = document.getElementById('warChart').getContext('2d');
        let currentChart;

        function initChart(type) {
            const data = dataSets[type];
            if (currentChart) currentChart.destroy();

            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'MeteoFrance (EU)', data: data.eu, borderColor: '#6366f1', borderWidth: 2, tension: 0.4, pointRadius: 0 },
                        { label: 'NOAA GFS (US)', data: data.gfs, borderColor: '#2ed573', borderWidth: 2, tension: 0.4, pointRadius: 0 },
                        { label: 'DWD ICON (DE)', data: data.icon, borderColor: '#ffa502', borderWidth: 2, borderDash: [4,4], tension: 0.4, pointRadius: 0 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { labels: { color: '#cbd5e1' } },
                        tooltip: { backgroundColor: '#0f172a', titleColor: '#fff', bodyColor: '#cbd5e1', borderColor: '#334155', borderWidth: 1 }
                    },
                    scales: {
                        y: {
                            title: { display: true, text: data.unit, color: '#64748b' },
                            grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' }
                        },
                        x: { grid: { display: false }, ticks: { color: '#94a3b8' } }
                    }
                }
            });
        }

        function updateChart(type, btnElement) {
            document.querySelectorAll('.btn-var').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');
            initChart(type);
        }

        initChart('temp');
    </script>

</body>
</html>